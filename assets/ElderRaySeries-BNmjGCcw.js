import{b as T,r as b}from"./baseIndicator-qdS_KWkb.js";import{e as F}from"./ema-YsYnLjx4.js";import{a as k}from"./defaultOptionsForComputation-CN7nWbKN.js";import{s as O}from"./slidingWindow-Zblwndst.js";import{m as z}from"./mean-DHO-D6Gx.js";import{z as M}from"./zip-Irq_DN6l.js";import{m as V}from"./merge-WqXt2Bz7.js";import{r as u}from"./index-CTzypqlY.js";import{b as j,m as G}from"./StackedBarSeries-C1rjxMaO.js";import{f as A,G as N,b as _,j as $}from"./withSize-Bqu-aQP_.js";import{p as I}from"./barWidth-H00B5QnB.js";import{S as W}from"./StraightLine-BDDeJkOw.js";function H(){let n=k,e=t=>({open:t.open,high:t.high,low:t.low,close:t.close});const r=t=>{const{windowSize:s,sourcePath:o,movingAverageType:h}=n,d=h==="ema"?F().options({windowSize:s,sourcePath:o}):O().windowSize(s).accumulator(c=>z(c)).sourcePath(o);return M(t,d(t)).map(c=>{const f=c[0],i=c[1],y=i!==void 0?e(f).high-i:void 0,B=i!==void 0?e(f).low-i:void 0;return{bullPower:y,bearPower:B}})};return r.undefinedLength=()=>{const{windowSize:t}=n;return t-1},r.ohlc=t=>t===void 0?e:(e=t,r),r.options=t=>t===void 0?n:(n=Object.assign(Object.assign({},k),t),r),r}const E="ElderRay";function ne(){const n=T().type(E).accessor(s=>s.elderRay),e=H(),r=V().algorithm(e).merge((s,o)=>{s.elderRay=o}),t=(s,o={merge:!0})=>{if(o.merge){if(!n.accessor())throw new Error(`Set an accessor to ${E} before calculating`);return r(s)}return e(s)};return b(t,n,"id","accessor","stroke","fill","echo","type"),b(t,e,"options"),b(t,r,"merge","skipUndefined"),t}class R extends u.Component{constructor(){super(...arguments),this.drawOnCanvas=(e,r)=>{const t=this.getBars(r);j(this.props,e,t)},this.getBars=e=>{const{xScale:r,xAccessor:t,chartConfig:{yScale:s},plotData:o}=e,{baseAt:h,fillStyle:d,stroke:c,yAccessor:f}=this.props,i=A(d),y=A(h),x=A(this.props.width)(this.props,e),S=Math.floor(.5*x),v=o.map(p=>{const l=f.map((a,w)=>{const P=a(p);if(P===void 0)return;const C=t(p),D=Math.round(r(C))-S,L=s(P);return{height:0,width:S*2,x:D,y:L,stroke:c?i(p,w):"none",fillStyle:i(p,w),i:w}}).filter(a=>a!==void 0);let g=y(r,s,p),m;for(let a=l.length-1;a>=0;a--)m=g-l[a].y,m<0&&(l[a].y=g,m=-1*m),l[a].height=m,g=l[a].y;return l});return G(v)}}render(){const{clip:e}=this.props;return u.createElement(N,{canvasToDraw:_,canvasDraw:this.drawOnCanvas,clip:e,drawOn:["pan"]})}}R.defaultProps={baseAt:(n,e)=>$(e.range()),clip:!0,direction:"up",stroke:!1,fillStyle:"#4682B4",widthRatio:.5,width:I};class U extends u.Component{constructor(){super(...arguments),this.yAccessorBullTop=e=>{const{yAccessor:r}=this.props;return r(e)&&(r(e).bullPower>0?r(e).bullPower:void 0)},this.yAccessorBearTop=e=>{const{yAccessor:r}=this.props;return r(e)&&(r(e).bearPower>0?r(e).bearPower:void 0)},this.yAccessorBullBottom=e=>{const{yAccessor:r}=this.props;return r(e)&&(r(e).bullPower<0?0:void 0)},this.yAccessorBearBottom=e=>{const{yAccessor:r}=this.props;return r(e)&&(r(e).bullPower<0||r(e).bullPower*r(e).bearPower<0?Math.min(0,r(e).bullPower):void 0)},this.yAccessorForBarBase=(e,r,t)=>{const{yAccessor:s}=this.props,o=s(t)&&Math.min(s(t).bearPower,0);return r(o)},this.fillForEachBar=(e,r)=>{const{fillStyle:t}=this.props;return r%2===0?t.bullPower:t.bearPower}}render(){const{className:e,clip:r,stroke:t,straightLineStrokeStyle:s,straightLineStrokeDasharray:o,widthRatio:h}=this.props;return u.createElement("g",{className:e},u.createElement(R,{baseAt:this.yAccessorForBarBase,stroke:t,fillStyle:this.fillForEachBar,widthRatio:h,clip:r,yAccessor:[this.yAccessorBullTop,this.yAccessorBearTop,this.yAccessorBullBottom,this.yAccessorBearBottom]}),u.createElement(W,{yValue:0,strokeStyle:s,lineDash:o}))}}U.defaultProps={fillStyle:{bearPower:"rgba(239, 83, 80, 0.7)",bullPower:"rgba(38, 166, 153, 0.7)"},className:"react-financial-charts-elderray-series",clip:!0,stroke:!0,straightLineStrokeStyle:"rgba(0, 0, 0, 0.7)",straightLineStrokeDasharray:"Dash",widthRatio:.8};export{U as E,ne as e};
