import{r as O}from"./index-CTzypqlY.js";import{g as $}from"./group-CTbjIu5X.js";import{c as w,a as z}from"./array-2GBN5xbU.js";import{i as M,h as X,f as b,G,b as P}from"./withSize-Bqu-aQP_.js";import{p as T}from"./barWidth-H00B5QnB.js";function C(n,t){if((i=n.length)>1)for(var a=1,s,o,r=n[t[0]],i,e=r.length;a<i;++a)for(o=r,r=n[t[a]],s=0;s<e;++s)r[s][1]+=r[s][0]=isNaN(o[s][1])?o[s][0]:o[s][1]}function B(n){for(var t=n.length,a=new Array(t);--t>=0;)a[t]=t;return a}function H(n,t){return n[t]}function L(n){const t=[];return t.key=n,t}function V(){var n=w([]),t=B,a=C,s=H;function o(r){var i=Array.from(n.apply(this,arguments),L),e,u=i.length,f=-1,h;for(const g of r)for(e=0,++f;e<u;++e)(i[e][f]=[0,+s(g,i[e].key,f,r)]).data=g;for(e=0,h=z(t(i));e<u;++e)i[h[e]].index=e;return a(i,h),i}return o.keys=function(r){return arguments.length?(n=typeof r=="function"?r:w(Array.from(r)),o):n},o.value=function(r){return arguments.length?(s=typeof r=="function"?r:w(+r),o):s},o.order=function(r){return arguments.length?(t=r==null?B:typeof r=="function"?r:w(Array.from(r)),o):t},o.offset=function(r){return arguments.length?(a=r??C,o):a},o}function*q(n){for(const t of n)yield*t}function I(n){return Array.from(q(n))}class J extends O.Component{constructor(){super(...arguments),this.drawOnCanvas=(t,a)=>{const{xAccessor:s}=a;Q(t,this.props,a,s,V)}}render(){const{clip:t}=this.props;return O.createElement(G,{clip:t,canvasDraw:this.drawOnCanvas,canvasToDraw:P,drawOn:["pan"]})}}J.defaultProps={baseAt:(n,t)=>X(t.range()),direction:"up",stroke:!1,fillStyle:"rgba(70, 130, 180, 0.5)",width:T,widthRatio:.8,clip:!0,swapScales:!1};function K(){let n=[];function t(a){return n.map((o,r)=>{const i=a.map(e=>{const u=[0,e[o]];return u.data=e,u});return i.key=o,i.index=r,i})}return t.keys=function(a){return arguments.length?(n=a,t):n},t}function Q(n,t,a,s,o,r=M,i=Z){const{xScale:e,chartConfig:{yScale:u},plotData:f}=a,h=U(t,s,f,e,u,o,i,r);j(t,n,h)}function E(n){return Array.isArray(n)?n:[n]}const U=(n,t,a,s,o,r,i,e)=>{const{yAccessor:u,swapScales:f}=n,h=E(f?t:u);return _(n,f?u:t,h,f?o:s,f?s:o,a,r,f?i:e)},Z=n=>n.map(t=>Object.assign(Object.assign({},t),{x:t.y,y:t.x,height:t.width,width:t.height})),j=(n,t,a)=>{const{stroke:s}=n;$(a,r=>r.fillStyle).forEach((r,i)=>{X(r).width>1&&i!==void 0&&(t.strokeStyle=i),t.fillStyle=i,r.forEach(e=>{e.width<=1?t.fillRect(e.x-.5,e.y,1,e.height):(t.fillRect(e.x+.5,e.y+.5,e.width,e.height),s&&t.strokeRect(e.x,e.y,e.width,e.height))})})};function _(n,t,a,s,o,r,i=K,e=M){const{baseAt:u,fillStyle:f,stroke:h,spaceBetweenBar:g=0}=n,k=b(f),v=b(u),m=b(n.width)(n,{xScale:s,xAccessor:t,plotData:r}),S=Math.round(m),A=(S-g*(a.length-1))/a.length,x=S===1?0:.5*m,N=r.map(c=>{const l={appearance:{},x:t(c)};return a.forEach((d,p)=>{const y=`y${p}`;l[y]=d(c);const F={stroke:h?k(c,p):"none",fillStyle:k(c,p)};l.appearance[y]=F}),l}),R=a.map((c,l)=>`y${l}`),W=i().keys(R)(N).map((c,l)=>{const d=c.key;return c.map(p=>{const y=[p[0],p[1]];return y.data={x:p.data.x,i:l,appearance:p.data.appearance[d]},y})}),Y=I(W).map(c=>{let l=o(c[1]),d=v(s,o,c.data)-o(c[1]-c[0]);return d<0&&(l=l+d,d=-d),Object.assign(Object.assign({},c.data.appearance),{x:Math.round(s(c.data.x)-m/2),y:l,groupOffset:Math.round(x-(c.data.i>0?(A+g)*c.data.i:0)),groupWidth:Math.round(A),offset:Math.round(x),height:d,width:S})}).filter(c=>!isNaN(c.y));return e(Y)}export{V as a,j as b,Q as d,K as i,I as m};
