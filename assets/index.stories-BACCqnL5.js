import{r as C}from"./index-CTzypqlY.js";import{i as Me,r as de}from"./group-CTbjIu5X.js";import{f as F,i as ae,h as O,l as q,$ as me,G as he,b as pe,w as Ee,m as Pe,n as Ve,o as le,X as Be,Y as Oe}from"./withSize-Bqu-aQP_.js";import{m as ge}from"./StackedBarSeries-C1rjxMaO.js";import{n as Fe,d as xe}from"./discontinuousTimeScaleProvider-DjLVsG-0.js";import{w as De}from"./withOHLCData-BEr55ucm.js";import{c as Ae}from"./change-BqrAuNKV.js";import{B as Ne}from"./BarSeries-CMNobAzD.js";import{C as _e}from"./CandlestickSeries-CTmIVn2R.js";import"./index-kspPnZk0.js";import"./jsx-runtime-D_zvdyIk.js";import"./array-2GBN5xbU.js";import"./barWidth-H00B5QnB.js";import"./baseIndicator-qdS_KWkb.js";import"./defaultOptionsForComputation-CN7nWbKN.js";import"./slidingWindow-Zblwndst.js";import"./functor-Bsi8uwFK.js";import"./path-uFnBsLuY.js";import"./merge-WqXt2Bz7.js";function ye(){let n=F(!1),e=Fe,r=ae,a=!1,t=!1;const i=function(u){let s=a?void 0:[];const l=[];let o=0,f=0;for(f=0;f<u.length;f++){const c=u[f];n(c,f,s||[])?(s&&s.length>0&&l.push(e(s,f,o++)),s=[r(c)]):s&&s.push(r(c))}return t||l.push(e(s,f,o)),l};return i.accumulateTill=function(u){return arguments.length?(n=F(u),i):n},i.accumulator=function(u){return arguments.length?(e=u,i):e},i.value=function(u){return arguments.length?(r=u,i):r},i.discardTillStart=function(u){return arguments.length?(a=u,i):a},i.discardTillEnd=function(u){return arguments.length?(t=u,i):t},i}function T(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function oe(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function we(n){let e,r,a;n.length!==2?(e=T,r=(s,l)=>T(n(s),l),a=(s,l)=>n(s)-l):(e=n===T||n===oe?n:qe,r=n,a=n);function t(s,l,o=0,f=s.length){if(o<f){if(e(l,l)!==0)return f;do{const c=o+f>>>1;r(s[c],l)<0?o=c+1:f=c}while(o<f)}return o}function i(s,l,o=0,f=s.length){if(o<f){if(e(l,l)!==0)return f;do{const c=o+f>>>1;r(s[c],l)<=0?o=c+1:f=c}while(o<f)}return o}function u(s,l,o=0,f=s.length){const c=t(s,l,o,f-1);return c>o&&a(s[c-1],l)>-a(s[c],l)?c-1:c}return{left:t,center:u,right:i}}function qe(){return 0}function Te(n){return n===null?NaN:+n}const Ke=we(T),We=Ke.right;we(Te).center;function Ge(n,e){let r=0;for(let a of n)a!=null&&(a=+a)>=a&&++r;return r}function te(n,e){let r,a;if(e===void 0)for(const t of n)t!=null&&(r===void 0?t>=t&&(r=a=t):(r>t&&(r=t),a<t&&(a=t)));else{let t=-1;for(let i of n)(i=e(i,++t,n))!=null&&(r===void 0?i>=i&&(r=a=i):(r>i&&(r=i),a<i&&(a=i)))}return[r,a]}var Ie=Array.prototype,Xe=Ie.slice;function ne(n){return()=>n}const ze=Math.sqrt(50),Le=Math.sqrt(10),He=Math.sqrt(2);function H(n,e,r){const a=(e-n)/Math.max(0,r),t=Math.floor(Math.log10(a)),i=a/Math.pow(10,t),u=i>=ze?10:i>=Le?5:i>=He?2:1;let s,l,o;return t<0?(o=Math.pow(10,-t)/u,s=Math.round(n*o),l=Math.round(e*o),s/o<n&&++s,l/o>e&&--l,o=-o):(o=Math.pow(10,t)*u,s=Math.round(n/o),l=Math.round(e/o),s*o<n&&++s,l*o>e&&--l),l<s&&.5<=r&&r<2?H(n,e,r*2):[s,l,o]}function Re(n,e,r){if(e=+e,n=+n,r=+r,!(r>0))return[];if(n===e)return[n];const a=e<n,[t,i,u]=a?H(e,n,r):H(n,e,r);if(!(i>=t))return[];const s=i-t+1,l=new Array(s);if(a)if(u<0)for(let o=0;o<s;++o)l[o]=(i-o)/-u;else for(let o=0;o<s;++o)l[o]=(i-o)*u;else if(u<0)for(let o=0;o<s;++o)l[o]=(t+o)/-u;else for(let o=0;o<s;++o)l[o]=(t+o)*u;return l}function re(n,e,r){return e=+e,n=+n,r=+r,H(n,e,r)[2]}function $e(n,e,r){let a;for(;;){const t=re(n,e,r);if(t===a||t===0||!isFinite(t))return[n,e];t>0?(n=Math.floor(n/t)*t,e=Math.ceil(e/t)*t):t<0&&(n=Math.ceil(n*t)/t,e=Math.floor(e*t)/t),a=t}}function Ye(n){return Math.max(1,Math.ceil(Math.log(Ge(n))/Math.LN2)+1)}function ve(){var n=Me,e=te,r=Ye;function a(t){Array.isArray(t)||(t=Array.from(t));var i,u=t.length,s,l,o=new Array(u);for(i=0;i<u;++i)o[i]=n(t[i],i,t);var f=e(o),c=f[0],m=f[1],h=r(o,c,m);if(!Array.isArray(h)){const B=m,A=+h;if(e===te&&([c,m]=$e(c,m,A)),h=Re(c,m,A),h[0]<=c&&(l=re(c,m,A)),h[h.length-1]>=m)if(B>=m&&e===te){const E=re(c,m,A);isFinite(E)&&(E>0?m=(Math.floor(m/E)+1)*E:E<0&&(m=(Math.ceil(m*-E)+1)/-E))}else h.pop()}for(var b=h.length,S=0,V=b;h[S]<=c;)++S;for(;h[V-1]>m;)--V;(S||V<b)&&(h=h.slice(S,V),b=V-S);var k=new Array(b+1),x;for(i=0;i<=b;++i)x=k[i]=[],x.x0=i>0?h[i-1]:c,x.x1=i<b?h[i]:m;if(isFinite(l)){if(l>0)for(i=0;i<u;++i)(s=o[i])!=null&&c<=s&&s<=m&&k[Math.min(b,Math.floor((s-c)/l))].push(t[i]);else if(l<0){for(i=0;i<u;++i)if((s=o[i])!=null&&c<=s&&s<=m){const B=Math.floor((c-s)*l);k[Math.min(b,B+(h[B]<=s))].push(t[i])}}}else for(i=0;i<u;++i)(s=o[i])!=null&&c<=s&&s<=m&&k[We(h,s,0,b)].push(t[i]);return k}return a.value=function(t){return arguments.length?(n=typeof t=="function"?t:ne(t),a):n},a.domain=function(t){return arguments.length?(e=typeof t=="function"?t:ne([t[0],t[1]]),a):e},a.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:ne(Array.isArray(t)?Xe.call(t):t),a):r},a}function be(n,e){let r;for(const a of n)a!=null&&(r<a||r===void 0&&a>=a)&&(r=a);return r}function je(n,e){let r;if(e===void 0)for(const a of n)a!=null&&(r>a||r===void 0&&a>=a)&&(r=a);else{let a=-1;for(let t of n)(t=e(t,++a,n))!=null&&(r>t||r===void 0&&t>=t)&&(r=t)}return r}function K(n,e){let r=0;if(e===void 0)for(let a of n)(a=+a)&&(r+=a);else{let a=-1;for(let t of n)(t=+e(t,++a,n))&&(r+=t)}return r}function Je(n){if(!(i=n.length))return[];for(var e=-1,r=je(n,Qe),a=new Array(r);++e<r;)for(var t=-1,i,u=a[e]=new Array(i);++t<i;)u[t]=n[t][e];return a}function Qe(n){return n.length}function Se(){return Je(arguments)}let Ce=class extends C.Component{constructor(){super(...arguments),this.drawOnCanvas=(e,r)=>{const{xAccessor:a,width:t}=r,{rects:i,sessionBg:u}=this.helper(this.props,r,a,t);this.drawOnCanvasContext(e,i,u)},this.drawOnCanvasContext=(e,r,a)=>{const{sessionBackGround:t,showSessionBackground:i}=this.props;i&&(t!==void 0&&(e.fillStyle=t),a.forEach(u=>{const{x:s,y:l,height:o,width:f}=u;e.beginPath(),e.rect(s,l,f,o),e.closePath(),e.fill()})),r.forEach(u=>{const{x:s,y:l,height:o,w1:f,w2:c,stroke1:m,stroke2:h,fill1:b,fill2:S}=u;f>0&&(e.fillStyle=b,m!=="none"&&(e.strokeStyle=m),e.beginPath(),e.rect(s,l,f,o),e.closePath(),e.fill(),m!=="none"&&e.stroke()),c>0&&(e.fillStyle=S,h!=="none"&&(e.strokeStyle=h),e.beginPath(),e.rect(s+f,l,c,o),e.closePath(),e.fill(),h!=="none"&&e.stroke())})},this.helper=(e,r,a,t)=>{const{xScale:i,chartConfig:{yScale:u},plotData:s}=r,{sessionStart:l,bySession:o,partialStartOK:f,partialEndOK:c,bins:m,maxProfileWidthPercent:h,source:b,volume:S,absoluteChange:V,orient:k,fill:x,stroke:B}=e,A=ye().discardTillStart(!f).discardTillEnd(!c).accumulateTill((y,M)=>l(Object.assign({d:y,i:M},r))).accumulator(ae),E=s.length>1?i(a(s[1]))-i(a(O(s))):0,W=(o?A(s):[s]).map(y=>{const M=o?i(a(O(y))):0,N=o?i(a(q(y))):t,_=N-M+E,R=ve().value(b).thresholds(m),$=d=>{const g=k==="right"?oe:T,w=d.sort((p,v)=>g(p.direction,v.direction));return de(w,p=>K(p,v=>v.volume),p=>p.direction)},G=R(y),I=G.map(d=>d.map(g=>V(g)>0?{direction:"up",volume:S(g)}:{direction:"down",volume:S(g)})).map(d=>Array.from($(d))),Y=I.map(d=>K(d.map(g=>g[1]))),j=d=>O(d.range()),[J,Q]=k==="right"?[M,M+_*h/100]:[N,N-_*(100-h)/100],X=me().domain([0,be(Y)]).range([J,Q]),U=I.map(d=>{const g=K(d,D=>D[1]),w=X(g),p=j(X)-w,v=p<0?w+p:w,ee=d.map(D=>({type:D[0],width:D[1]*Math.abs(p)/g}));return{x:v,ws:ee,totalVolumeX:w}}),P=Se(G,U).map(([d,{x:g,ws:w}])=>{const p=w[0]||{type:"up",width:0},v=w[1]||{type:"down",width:0};return{y:u(d.x1),height:u(d.x1)-u(d.x0),x:g,width:t,w1:p.width,w2:v.width,stroke1:F(B)(p),stroke2:F(B)(v),fill1:F(x)(p),fill2:F(x)(v)}}),Z={x:M,y:q(P).y,height:O(P).y-q(P).y+O(P).height,width:_};return{rects:P,sessionBg:Z}});return{rects:ge(W.map(y=>y.rects)),sessionBg:W.map(y=>y.sessionBg)}}}render(){return C.createElement(he,{canvasDraw:this.drawOnCanvas,canvasToDraw:pe,drawOn:["pan"]})}};Ce.defaultProps={absoluteChange:n=>n.absoluteChange,bins:20,bySession:!1,fill:({type:n})=>n==="up"?"rgba(38, 166, 154, 0.5)":"rgba(239, 83, 80, 0.5)",maxProfileWidthPercent:50,orient:"left",partialStartOK:!0,partialEndOK:!0,sessionBackGround:"rgba(70, 130, 180, 0.3)",sessionStart:({d:n,i:e,plotData:r})=>e>0&&r[e-1].date.getMonth()!==n.date.getMonth(),showSessionBackground:!1,source:n=>n.close,stroke:"#FFFFFF",volume:n=>n.volume};const se=class se extends C.Component{constructor(){super(...arguments),this.drawOnCanvas=(e,r)=>{const{xAccessor:a,width:t}=r,{rects:i,sessionBg:u}=this.helper(this.props,r,a,t);this.drawOnCanvasContext(e,i,u)},this.drawOnCanvasContext=(e,r,a)=>{const{sessionBackGround:t,showSessionBackground:i}=this.props;i&&(t!==void 0&&(e.fillStyle=t),a.forEach(u=>{const{x:s,y:l,height:o,width:f}=u;e.beginPath(),e.rect(s,l,f,o),e.closePath(),e.fill()})),r.forEach(u=>{const{x:s,y:l,height:o,w1:f,w2:c,stroke1:m,stroke2:h,fill1:b,fill2:S}=u;f>0&&(e.fillStyle=b,m!=="none"&&(e.strokeStyle=m),e.beginPath(),e.rect(s,l,f,o),e.closePath(),e.fill(),m!=="none"&&e.stroke()),c>0&&(e.fillStyle=S,h!=="none"&&(e.strokeStyle=h),e.beginPath(),e.rect(s+f,l,c,o),e.closePath(),e.fill(),h!=="none"&&e.stroke())})},this.helper=(e,r,a,t)=>{const{xScale:i,chartConfig:{yScale:u},plotData:s}=r,{sessionStart:l,bySession:o,partialStartOK:f,partialEndOK:c,bins:m,maxProfileWidthPercent:h,source:b,volume:S,absoluteChange:V,orient:k,fill:x,stroke:B}=e,A=ye().discardTillStart(!f).discardTillEnd(!c).accumulateTill((y,M)=>l({d:y,i:M,...r})).accumulator(ae),E=s.length>1?i(a(s[1]))-i(a(O(s))):0,W=(o?A(s):[s]).map(y=>{const M=o?i(a(O(y))):0,N=o?i(a(q(y))):t,_=N-M+E,R=ve().value(b).thresholds(m),$=d=>{const g=k==="right"?oe:T,w=d.sort((p,v)=>g(p.direction,v.direction));return de(w,p=>K(p,v=>v.volume),p=>p.direction)},G=R(y),I=G.map(d=>d.map(g=>V(g)>0?{direction:"up",volume:S(g)}:{direction:"down",volume:S(g)})).map(d=>Array.from($(d))),Y=I.map(d=>K(d.map(g=>g[1]))),j=d=>O(d.range()),[J,Q]=k==="right"?[M,M+_*h/100]:[N,N-_*(100-h)/100],X=me().domain([0,be(Y)]).range([J,Q]),U=I.map(d=>{const g=K(d,D=>D[1]),w=X(g),p=j(X)-w,v=p<0?w+p:w,ee=d.map(D=>({type:D[0],width:D[1]*Math.abs(p)/g}));return{x:v,ws:ee,totalVolumeX:w}}),P=Se(G,U).map(([d,{x:g,ws:w}])=>{const p=w[0]||{type:"up",width:0},v=w[1]||{type:"down",width:0};return{y:u(d.x1),height:u(d.x1)-u(d.x0),x:g,width:t,w1:p.width,w2:v.width,stroke1:F(B)(p),stroke2:F(B)(v),fill1:F(x)(p),fill2:F(x)(v)}}),Z={x:M,y:q(P).y,height:O(P).y-q(P).y+O(P).height,width:_};return{rects:P,sessionBg:Z}});return{rects:ge(W.map(y=>y.rects)),sessionBg:W.map(y=>y.sessionBg)}}}render(){return C.createElement(he,{canvasDraw:this.drawOnCanvas,canvasToDraw:pe,drawOn:["pan"]})}};se.defaultProps={absoluteChange:e=>e.absoluteChange,bins:20,bySession:!1,fill:({type:e})=>e==="up"?"rgba(38, 166, 154, 0.5)":"rgba(239, 83, 80, 0.5)",maxProfileWidthPercent:50,orient:"left",partialStartOK:!0,partialEndOK:!0,sessionBackGround:"rgba(70, 130, 180, 0.3)",sessionStart:({d:e,i:r,plotData:a})=>r>0&&a[r-1].date.getMonth()!==e.date.getMonth(),showSessionBackground:!1,source:e=>e.close,stroke:"#FFFFFF",volume:e=>e.volume};let z=se;try{z.displayName="VolumeProfileSeries",z.__docgenInfo={description:"",displayName:"VolumeProfileSeries",props:{absoluteChange:{defaultValue:{value:"(d: any) => d.absoluteChange"},description:"",name:"absoluteChange",required:!1,type:{name:"(datum: any) => number"}},bins:{defaultValue:{value:"20"},description:"",name:"bins",required:!1,type:{name:"number"}},bySession:{defaultValue:{value:"false"},description:"",name:"bySession",required:!1,type:{name:"boolean | undefined"}},fill:{defaultValue:{value:`({ type }: { type: "up" | "down"; width: number }) =>
            type === "up" ? "rgba(38, 166, 154, 0.5)" : "rgba(239, 83, 80, 0.5)"`},description:"",name:"fill",required:!1,type:{name:'((widthType: { type: "up" | "down"; width: number; }) => string) | undefined'}},maxProfileWidthPercent:{defaultValue:{value:"50"},description:"",name:"maxProfileWidthPercent",required:!1,type:{name:"number"}},orient:{defaultValue:{value:"left"},description:"",name:"orient",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"left"'},{value:'"right"'}]}},partialStartOK:{defaultValue:{value:"true"},description:"",name:"partialStartOK",required:!1,type:{name:"boolean | undefined"}},partialEndOK:{defaultValue:{value:"true"},description:"",name:"partialEndOK",required:!1,type:{name:"boolean | undefined"}},sessionBackGround:{defaultValue:{value:"rgba(70, 130, 180, 0.3)"},description:"",name:"sessionBackGround",required:!1,type:{name:"string | undefined"}},sessionStart:{defaultValue:{value:"({ d, i, plotData }: any) => i > 0 && plotData[i - 1].date.getMonth() !== d.date.getMonth()"},description:"",name:"sessionStart",required:!1,type:{name:"({ d, i, plotData }: any) => boolean"}},showSessionBackground:{defaultValue:{value:"false"},description:"",name:"showSessionBackground",required:!1,type:{name:"boolean | undefined"}},source:{defaultValue:{value:"(d: any) => d.close"},description:"",name:"source",required:!1,type:{name:"(d: number, i: number, data: ArrayLike<number>) => number"}},stroke:{defaultValue:{value:"#FFFFFF"},description:"",name:"stroke",required:!1,type:{name:"string | undefined"}},volume:{defaultValue:{value:"(d: any) => d.volume"},description:"",name:"volume",required:!1,type:{name:"(datum: any) => number"}}}}}catch{}class ie extends C.Component{constructor(){super(...arguments),this.margin={left:0,right:40,top:0,bottom:24},this.xScaleProvider=xe().inputDateAccessor(e=>e.date),this.barChartExtents=e=>e.volume,this.yExtents=e=>[e.high,e.low],this.volumeSeries=e=>e.volume}render(){const{data:e,height:r,ratio:a,width:t}=this.props,i=Ae()(e),{data:u,xScale:s,xAccessor:l,displayXAccessor:o}=this.xScaleProvider(i),c=(r-this.margin.top-this.margin.bottom)/4,m=(V,k)=>[0,k-c],h=l(u[u.length-1]),S=[l(u[Math.max(0,u.length-100)]),h];return C.createElement(Ve,{height:r,ratio:a,width:t,margin:this.margin,data:u,displayXAccessor:o,seriesName:"Data",xScale:s,xAccessor:l,xExtents:S},C.createElement(le,{id:1,height:c,origin:m,yExtents:this.barChartExtents},C.createElement(Ne,{yAccessor:this.volumeSeries})),C.createElement(le,{id:2,yExtents:this.yExtents},C.createElement(_e,null),C.createElement(Ce,null),C.createElement(Be,null),C.createElement(Oe,null)))}}const Ue=De()(Ee()(Pe()(ie)));try{ie.displayName="VolumeProfile",ie.__docgenInfo={description:"",displayName:"VolumeProfile",props:{}}}catch{}try{componentDidMount.displayName="componentDidMount",componentDidMount.__docgenInfo={description:"Called immediately after a component is mounted. Setting state here will trigger re-rendering.",displayName:"componentDidMount",props:{}}}catch{}const vt={title:"Visualization/Indicator/Volume Profile",component:z},L=()=>C.createElement(Ue,null);var ue,ce,fe;L.parameters={...L.parameters,docs:{...(ue=L.parameters)==null?void 0:ue.docs,source:{originalSource:"() => <VolumeProfile />",...(fe=(ce=L.parameters)==null?void 0:ce.docs)==null?void 0:fe.source}}};const bt=["basic"];export{bt as __namedExportsOrder,L as basic,vt as default};
