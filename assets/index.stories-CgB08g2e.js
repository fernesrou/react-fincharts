import{r as g}from"./index-CTzypqlY.js";import{c as S,p as M,G as L,b as X,w as q,m as j,n as H,o as $,X as x,Y as F}from"./withSize-Bqu-aQP_.js";import{w as z}from"./withOHLCData-BEr55ucm.js";import{b as U,r as D}from"./baseIndicator-qdS_KWkb.js";import{a as J}from"./atr-C5J7OhYf.js";import{K as W}from"./defaultOptionsForComputation-CN7nWbKN.js";import{m as Z}from"./merge-WqXt2Bz7.js";import{f as ee}from"./functor-Bsi8uwFK.js";import{p as te}from"./path-uFnBsLuY.js";import{d as ae}from"./discontinuousTimeScaleProvider-DjLVsG-0.js";import"./jsx-runtime-D_zvdyIk.js";import"./index-kspPnZk0.js";import"./slidingWindow-Zblwndst.js";function re(){let y=W,t=a=>a.date,l=(a,n)=>{a.date=n};const o=a=>{const{reversalType:n,windowSize:s,reversal:i,sourcePath:k}=y,f=te(k);let d;if(n==="ATR"){const r=J().options({windowSize:s});Z().algorithm(r).merge((p,T)=>{p["atr"+s]=T})(a),d=p=>p["atr"+s]}else d=ee(i);const v=[];let u,c,h,e={};return a.forEach(function(r){e.from===void 0&&(l(e,t(r)),e.from=t(r),e.open||(e.open=r.open),e.high=r.high,e.low=r.low,e.close||(e.close=f(r)),e.startOfYear=r.startOfYear,e.startOfQuarter=r.startOfQuarter,e.startOfMonth=r.startOfMonth,e.startOfWeek=r.startOfWeek),e.startOfYear||(e.startOfYear=r.startOfYear,e.startOfYear&&(e.date=r.date)),e.startOfQuarter||(e.startOfQuarter=r.startOfQuarter,e.startOfQuarter&&!e.startOfYear&&(e.date=r.date)),e.startOfMonth||(e.startOfMonth=r.startOfMonth,e.startOfMonth&&!e.startOfQuarter&&(e.date=r.date)),e.startOfWeek||(e.startOfWeek=r.startOfWeek,e.startOfWeek&&!e.startOfMonth&&(e.date=r.date)),e.volume=(e.volume||0)+r.volume,e.high=Math.max(e.high,r.high),e.low=Math.min(e.low,r.low),e.to=t(r);const m=f(r)-e.close;if(e.close>=e.open&&m>0||e.close<e.open&&m<0)e.close=f(r),c&&e.close<c&&(e.changePoint=c,e.startAs!=="yin"&&(e.changeTo="yin")),u&&e.close>u&&(e.changePoint=u,e.startAs!=="yang"&&(e.changeTo="yang"));else if(e.close>=e.open&&m<0&&Math.abs(m)>d(r)||e.close<e.open&&m>0&&Math.abs(m)>d(r)){const T=e.close;h=(e.close-e.open)/Math.abs(e.close-e.open);let O,_;h<0?(u===void 0&&(u=e.open),c=e.close,f(r)>u&&(O=u,_="yang")):(c===void 0&&(c=e.open),u=e.close,f(r)<c&&(O=c,_="yin")),e.startAs===void 0&&(e.startAs=h>0?"yang":"yin");const B=e.changeTo||e.startAs;e.added=!0,v.push(e),h=-1*h,e=Object.assign({},e),e.open=T,e.close=f(r),e.startAs=B,e.changePoint=O,e.changeTo=_,e.added=!1,e.from=void 0,e.volume=0}e.current=f(r);let p=e.close-e.open;p=p===0?1:p/Math.abs(p),e.reverseAt=p>0?e.close-d(r):e.open-d(r)}),e.added||v.push(e),v};return o.options=a=>a===void 0?y:(y=Object.assign(Object.assign({},W),a),o),o.dateMutator=a=>a===void 0?l:(l=a,o),o.dateAccessor=a=>a===void 0?t:(t=a,o),o}const ne="Kagi";function oe(){const y=U().type(ne),t=re(),l=t;return D(l,y,"id","stroke","fill","echo","type"),D(l,t,"dateAccessor","dateMutator","options"),l}let G=class extends g.Component{constructor(){super(...arguments),this.drawOnCanvas=(t,l)=>{const{stroke:o,strokeWidth:a,currentValueStroke:n}=this.props,{xAccessor:s,xScale:i,chartConfig:{yScale:k},plotData:f}=l,d=this.helper(f,s);let v=!0;d.forEach(m=>{t.strokeStyle=o[m.type],a!==void 0&&(t.lineWidth=a),t.beginPath();let p;m.plot.forEach(T=>{const[O,_]=[i(T[0]),k(T[1])];v?(t.moveTo(O,_),v=!1):(M(p)&&t.lineTo(p,_),t.lineTo(O,_)),p=O}),t.stroke()});const u=d[d.length-1].plot,c=u[u.length-1];t.beginPath(),t.lineWidth=1;const[h,e,r]=[i(c[0]),k(c[2]),k(c[3])];t.moveTo(h,e),t.lineTo(h+10,e),t.stroke(),t.beginPath(),n!==void 0&&(t.strokeStyle=n),t.moveTo(h-10,r),t.lineTo(h,r),t.stroke()},this.helper=(t,l)=>{const o=[];let a={},n=t[0],s=l(n);for(let i=0;i<t.length;i++)n=t[i],!S(n.close)&&(S(a.type)&&(a.type=n.startAs),S(a.plot)&&(a.plot=[]),s=l(n),a.plot.push([s,n.open]),M(n.changeTo)&&(a.plot.push([s,n.changePoint]),a.added=!0,o.push(a),a={type:n.changeTo,plot:[],added:!1},a.plot.push([s,n.changePoint])));return a.added||(a.plot.push([s,n.close,n.current,n.reverseAt]),o.push(a)),o}}render(){return g.createElement(L,{canvasToDraw:X,canvasDraw:this.drawOnCanvas,drawOn:["pan"]})}};G.defaultProps={currentValueStroke:"#000000",fill:{yang:"none",yin:"none"},stroke:{yang:"#26a69a",yin:"#ef5350"},strokeWidth:2};const E=class E extends g.Component{constructor(){super(...arguments),this.drawOnCanvas=(t,l)=>{const{stroke:o,strokeWidth:a,currentValueStroke:n}=this.props,{xAccessor:s,xScale:i,chartConfig:{yScale:k},plotData:f}=l,d=this.helper(f,s);let v=!0;d.forEach(m=>{t.strokeStyle=o[m.type],a!==void 0&&(t.lineWidth=a),t.beginPath();let p;m.plot.forEach(T=>{const[O,_]=[i(T[0]),k(T[1])];v?(t.moveTo(O,_),v=!1):(M(p)&&t.lineTo(p,_),t.lineTo(O,_)),p=O}),t.stroke()});const u=d[d.length-1].plot,c=u[u.length-1];t.beginPath(),t.lineWidth=1;const[h,e,r]=[i(c[0]),k(c[2]),k(c[3])];t.moveTo(h,e),t.lineTo(h+10,e),t.stroke(),t.beginPath(),n!==void 0&&(t.strokeStyle=n),t.moveTo(h-10,r),t.lineTo(h,r),t.stroke()},this.helper=(t,l)=>{const o=[];let a={},n=t[0],s=l(n);for(let i=0;i<t.length;i++)n=t[i],!S(n.close)&&(S(a.type)&&(a.type=n.startAs),S(a.plot)&&(a.plot=[]),s=l(n),a.plot.push([s,n.open]),M(n.changeTo)&&(a.plot.push([s,n.changePoint]),a.added=!0,o.push(a),a={type:n.changeTo,plot:[],added:!1},a.plot.push([s,n.changePoint])));return a.added||(a.plot.push([s,n.close,n.current,n.reverseAt]),o.push(a)),o}}render(){return g.createElement(L,{canvasToDraw:X,canvasDraw:this.drawOnCanvas,drawOn:["pan"]})}};E.defaultProps={currentValueStroke:"#000000",fill:{yang:"none",yin:"none"},stroke:{yang:"#26a69a",yin:"#ef5350"},strokeWidth:2};let A=E;try{A.displayName="KagiSeries",A.__docgenInfo={description:"`KagiSeries` tracks price movement mostly independantly of time.",displayName:"KagiSeries",props:{currentValueStroke:{defaultValue:{value:"#000000"},description:"Current value stroke",name:"currentValueStroke",required:!1,type:{name:"string | undefined"}},fill:{defaultValue:{value:`{
            yang: "none",
            yin: "none",
        }`},description:"Fill values.",name:"fill",required:!1,type:{name:"{ yang: string; yin: string; }"}},stroke:{defaultValue:{value:`{
            yang: "#26a69a",
            yin: "#ef5350",
        }`},description:"Stroke values.",name:"stroke",required:!1,type:{name:"{ yang: string; yin: string; }"}},strokeWidth:{defaultValue:{value:"2"},description:"Stroke width.",name:"strokeWidth",required:!1,type:{name:"number | undefined"}}}}}catch{}class R extends g.Component{constructor(){super(...arguments),this.margin={left:0,right:40,top:0,bottom:24},this.xScaleProvider=ae().inputDateAccessor(t=>t.date),this.yExtents=t=>[t.high,t.low]}render(){const{data:t,height:l,ratio:o,width:a}=this.props,s=oe()(t),{data:i,xScale:k,xAccessor:f,displayXAccessor:d}=this.xScaleProvider(s),v=f(i[i.length-1]),c=[f(i[Math.max(0,i.length-100)]),v];return g.createElement(H,{height:l,ratio:o,width:a,margin:this.margin,data:i,displayXAccessor:d,seriesName:"Data",xScale:k,xAccessor:f,xExtents:c},g.createElement($,{id:1,yExtents:this.yExtents},g.createElement(G,null),g.createElement(x,null),g.createElement(F,null)))}}const b=z()(q()(j()(R))),C=z("MINUTES")(q()(j()(R)));try{b.displayName="Daily",b.__docgenInfo={description:"",displayName:"Daily",props:{}}}catch{}try{componentDidMount.displayName="componentDidMount",componentDidMount.__docgenInfo={description:"Called immediately after a component is mounted. Setting state here will trigger re-rendering.",displayName:"componentDidMount",props:{}}}catch{}try{C.displayName="Intraday",C.__docgenInfo={description:"",displayName:"Intraday",props:{}}}catch{}const Oe={component:A,title:"Visualization/Series/Kagi"},P=()=>g.createElement(b,null),w=()=>g.createElement(C,null);var I,N,V;P.parameters={...P.parameters,docs:{...(I=P.parameters)==null?void 0:I.docs,source:{originalSource:"() => <Daily />",...(V=(N=P.parameters)==null?void 0:N.docs)==null?void 0:V.source}}};var Y,K,Q;w.parameters={...w.parameters,docs:{...(Y=w.parameters)==null?void 0:Y.docs,source:{originalSource:"() => <Intraday />",...(Q=(K=w.parameters)==null?void 0:K.docs)==null?void 0:Q.source}}};const _e=["daily","intraday"];export{_e as __namedExportsOrder,P as daily,Oe as default,w as intraday};
