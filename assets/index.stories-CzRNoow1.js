import{r as u}from"./index-CTzypqlY.js";import{l as k,j as O,G as H,g as P,b as I,w as F,m as T,n as Y,o as q,X as N,Y as W}from"./withSize-Bqu-aQP_.js";import{w as X}from"./withOHLCData-BEr55ucm.js";import{b as j,r as M}from"./baseIndicator-qdS_KWkb.js";import{S as b}from"./defaultOptionsForComputation-CN7nWbKN.js";import{m as $}from"./mappedSlidingWindow-CUioMVN6.js";import{m as L}from"./merge-WqXt2Bz7.js";import{d as B}from"./discontinuousTimeScaleProvider-DjLVsG-0.js";import{S as z}from"./SingleValueTooltip-CQ4GxCuA.js";import"./jsx-runtime-D_zvdyIk.js";import"./index-kspPnZk0.js";import"./functor-Bsi8uwFK.js";import"./ToolTipTSpanLabel-D8pipyNG.js";function G(o,e){const i=o.risingSar+o.af*(o.risingEp-o.risingSar),s=o.fallingSar-o.af*(o.fallingSar-o.fallingEp),t=Math.max(o.risingEp,e.high),r=Math.min(o.fallingEp,e.low);return{risingSar:i,fallingSar:s,risingEp:t,fallingEp:r}}function J(){let o=b;const e=i=>{const{accelerationFactor:s,maxAccelerationFactor:t}=o;return $().windowSize(2).undefinedValue(({high:n,low:a})=>({risingSar:a,risingEp:n,fallingSar:n,fallingEp:a,af:s})).accumulator(([n,a])=>{const{risingSar:g,fallingSar:h,risingEp:p,fallingEp:f}=G(n,a);if(n.use===void 0&&g>a.low&&h<a.high)return{risingSar:g,fallingSar:h,risingEp:p,fallingEp:f};const c=n.use!==void 0?n.use==="rising"?g>a.low?"falling":"rising":h<a.high?"rising":"falling":g>a.low?"falling":"rising",d=n.use===c?{af:Math.min(t,n.af+s),fallingEp:f,risingEp:p,fallingSar:h,risingSar:g}:{af:s,fallingEp:a.low,risingEp:a.high,fallingSar:Math.max(n.risingEp,a.high),risingSar:Math.min(n.fallingEp,a.low)},{date:m,high:S,low:y}=a;return Object.assign(Object.assign({date:m,high:S,low:y},d),{use:c,sar:c==="falling"?d.fallingSar:d.risingSar})})(i).map(n=>n.sar)};return e.undefinedLength=()=>1,e.options=i=>i===void 0?o:(o=Object.assign(Object.assign({},b),i),e),e}const w="SMA";function K(){const o=j().type(w).accessor(t=>t.sar),e=J(),i=L().algorithm(e).merge((t,r)=>{t.sar=r}),s=(t,r={merge:!0})=>{if(r.merge){if(!o.accessor())throw new Error(`Set an accessor to ${w} before calculating`);return i(t)}return e(t)};return M(s,o,"id","accessor","stroke","echo","type"),M(s,e,"options","undefinedLength"),M(s,i,"merge"),s}let V=class R extends u.Component{constructor(){super(...arguments),this.drawOnCanvas=(e,i)=>{const{yAccessor:s,fillStyle:t=R.defaultProps.fillStyle,strokeStyle:r}=this.props,{xAccessor:l,plotData:n,xScale:a,chartConfig:{yScale:g},hovering:h}=i,f=(a(l(k(n)))-a(l(O(n))))/n.length*.5/2,c=Math.min(2,Math.max(.5,f))+(h?2:0);n.forEach(d=>{const m=s(d);if(m===void 0)return;const S=a(l(d)),y=g(m),A=m>d.close?t.falling:t.rising;e.fillStyle=A,r!==void 0&&(e.strokeStyle=m>d.close?r.falling:r.rising),e.beginPath(),e.ellipse(S,y,c,c,0,0,2*Math.PI),e.closePath(),e.fill(),r!==void 0&&e.stroke()})},this.isHover=e=>{const{mouseXY:i,currentItem:s,chartConfig:{yScale:t}}=e,{yAccessor:r}=this.props,l=i[1],n=t(r(s));return l<n+5&&l>n-5}}render(){const{highlightOnHover:e,onClick:i,onDoubleClick:s,onContextMenu:t}=this.props,r=e?{isHover:this.isHover,drawOn:["mousemove","pan"],canvasToDraw:P}:{drawOn:["pan"],canvasToDraw:I};return u.createElement(H,Object.assign({canvasDraw:this.drawOnCanvas,onClickWhenHover:i,onDoubleClickWhenHover:s,onContextMenuWhenHover:t},r))}};V.defaultProps={fillStyle:{falling:"#4682B4",rising:"#15EC2E"},highlightOnHover:!1};const C=class C extends u.Component{constructor(){super(...arguments),this.drawOnCanvas=(e,i)=>{const{yAccessor:s,fillStyle:t=C.defaultProps.fillStyle,strokeStyle:r}=this.props,{xAccessor:l,plotData:n,xScale:a,chartConfig:{yScale:g},hovering:h}=i,f=(a(l(k(n)))-a(l(O(n))))/n.length*.5/2,c=Math.min(2,Math.max(.5,f))+(h?2:0);n.forEach(d=>{const m=s(d);if(m===void 0)return;const S=a(l(d)),y=g(m),A=m>d.close?t.falling:t.rising;e.fillStyle=A,r!==void 0&&(e.strokeStyle=m>d.close?r.falling:r.rising),e.beginPath(),e.ellipse(S,y,c,c,0,0,2*Math.PI),e.closePath(),e.fill(),r!==void 0&&e.stroke()})},this.isHover=e=>{const{mouseXY:i,currentItem:s,chartConfig:{yScale:t}}=e,{yAccessor:r}=this.props,l=i[1],n=t(r(s));return l<n+5&&l>n-5}}render(){const{highlightOnHover:e,onClick:i,onDoubleClick:s,onContextMenu:t}=this.props,r=e?{isHover:this.isHover,drawOn:["mousemove","pan"],canvasToDraw:P}:{drawOn:["pan"],canvasToDraw:I};return u.createElement(H,{canvasDraw:this.drawOnCanvas,onClickWhenHover:i,onDoubleClickWhenHover:s,onContextMenuWhenHover:t,...r})}};C.defaultProps={fillStyle:{falling:"#4682B4",rising:"#15EC2E"},highlightOnHover:!1};let E=C;try{E.displayName="SARSeries",E.__docgenInfo={description:`SAR stands for 'stop and reverse'.
The indicator is below prices as they're rising and above
prices as they're falling. In this regard, the indicator
stops and reverses when the price trend reverses and breaks above or below the indicator.`,displayName:"SARSeries",props:{fillStyle:{defaultValue:{value:`{
            falling: "#4682B4",
            rising: "#15EC2E",
        }`},description:"",name:"fillStyle",required:!1,type:{name:"{ falling: string; rising: string; } | undefined"}},strokeStyle:{defaultValue:null,description:"",name:"strokeStyle",required:!1,type:{name:"{ falling: string; rising: string; } | undefined"}},highlightOnHover:{defaultValue:{value:"false"},description:"",name:"highlightOnHover",required:!1,type:{name:"boolean | undefined"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: MouseEvent<Element, MouseEvent>, moreProps: any) => void) | undefined"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"((e: MouseEvent<Element, MouseEvent>, moreProps: any) => void) | undefined"}},onContextMenu:{defaultValue:null,description:"",name:"onContextMenu",required:!1,type:{name:"((e: MouseEvent<Element, MouseEvent>, moreProps: any) => void) | undefined"}},yAccessor:{defaultValue:null,description:"",name:"yAccessor",required:!0,type:{name:"(datum: any) => number | undefined"}}}}}catch{}class Q extends u.Component{constructor(){super(...arguments),this.accelerationFactor=.02,this.maxAccelerationFactor=.2,this.margin={left:0,right:40,top:8,bottom:24},this.xScaleProvider=B().inputDateAccessor(e=>e.date),this.sarCalculator=K().options({accelerationFactor:this.accelerationFactor,maxAccelerationFactor:this.maxAccelerationFactor}).merge((e,i)=>{e.sar=i}).accessor(e=>e.sar)}render(){const{data:e,height:i,ratio:s,width:t}=this.props,r=this.sarCalculator(e),{data:l,xScale:n,xAccessor:a,displayXAccessor:g}=this.xScaleProvider(r),h=a(l[l.length-1]),f=[a(l[Math.max(0,l.length-100)]),h],c=this.sarCalculator.accessor();return u.createElement(Y,{height:i,ratio:s,width:t,margin:this.margin,data:l,displayXAccessor:g,seriesName:"Data",xScale:n,xAccessor:a,xExtents:f},u.createElement(q,{id:1,yExtents:c},u.createElement(N,null),u.createElement(W,null),u.createElement(V,{yAccessor:c}),u.createElement(z,{yLabel:`SAR (${this.accelerationFactor}, ${this.maxAccelerationFactor})`,yAccessor:c,origin:[8,8]})))}}const U=X()(F()(T()(Q)));try{SarIndicator.displayName="SarIndicator",SarIndicator.__docgenInfo={description:"",displayName:"SarIndicator",props:{}}}catch{}try{componentDidMount.displayName="componentDidMount",componentDidMount.__docgenInfo={description:"Called immediately after a component is mounted. Setting state here will trigger re-rendering.",displayName:"componentDidMount",props:{}}}catch{}const ge={title:"Visualization/Indicator/SAR",component:E},v=()=>u.createElement(U,null);var x,D,_;v.parameters={...v.parameters,docs:{...(x=v.parameters)==null?void 0:x.docs,source:{originalSource:"() => <SARIndicator />",...(_=(D=v.parameters)==null?void 0:D.docs)==null?void 0:_.source}}};const me=["basic"];export{me as __namedExportsOrder,v as basic,ge as default};
